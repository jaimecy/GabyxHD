<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Montajes GabyxHD 2025</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        /* Fallback para Font Awesome - evitar advertencias */
        .fas, .fa {
            font-family: 'Font Awesome 6 Free', 'Font Awesome 5 Free', 'Font Awesome 4.7.0', 'FontAwesome', sans-serif;
            font-weight: 900;
            font-style: normal;
            font-display: swap;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: white;
            font-size: 1.2rem;
        }

        .spinner {
            display: inline-block;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: #ff6b6b;
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }

        .data-table {
            background: white;
            border-radius: 15px;
            padding: 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow-x: auto;
            overflow-y: hidden;
            margin-bottom: 20px;
            min-width: 100%;
        }

        /* Solo la tabla principal tiene scroll y sticky header */
        #data-container .data-table {
            max-height: 70vh;
            overflow-y: auto;
            overflow-x: scroll;
            scrollbar-width: thin;
            scrollbar-color: #ff0000 #f0f0f0;
        }

        /* Sticky header para la tabla principal */
        #data-container .data-table th {
            position: sticky;
            top: 0;
            z-index: 10;
            background-color: #667eea;
            color: white;
            font-weight: 600;
            text-align: center;
        }

        /* Estilos del scrollbar para la tabla principal - igual que an√°lisis */
        #data-container .data-table::-webkit-scrollbar {
            height: 8px;
            background: #f0f0f0;
        }

        #data-container .data-table::-webkit-scrollbar-thumb {
            background: #ff0000;
            border-radius: 2px;
        }

        #data-container .data-table::-webkit-scrollbar-track {
            background: #f0f0f0;
            border-radius: 2px;
        }

        /* Asegurar que la tabla tenga ancho m√≠nimo para forzar scroll */
        #data-container table {
            min-width: 1200px;
        }

        /* Las tablas del an√°lisis NO tienen scroll interno */
        #analysis-container .data-table {
            overflow-y: visible;
            max-height: none;
            overflow-x: hidden;
            width: 100%;
        }

        /* Estilos espec√≠ficos para las tablas del an√°lisis */
        #analysis-container table {
            width: 100%;
            min-width: 600px;
            border-collapse: collapse;
            color: black;
            overflow-x: auto;
        }

        #analysis-container th, #analysis-container td {
            padding: 8px;
            text-align: left;
            border: 1px solid black !important;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        #analysis-container th {
            background-color: #667eea;
            color: white;
            font-weight: 600;
            text-align: center;
        }

        #analysis-container td:nth-child(2), #analysis-container td:nth-child(3) {
            text-align: center;
        }

        .data-table h2 {
            color: #667eea;
            margin-bottom: 20px;
            text-align: center;
        }

        table {
            width: 100%;
            min-width: 800px;
            border-collapse: collapse;
            margin-top: 0;
            table-layout: auto;
        }

        th, td {
            padding: 8px 8px;
            text-align: left;
            border-bottom: 1px solid black !important;
            border-right: 1px solid black !important;
            word-wrap: break-word;
            white-space: nowrap;
        }



        /* Hacer que las columnas se adapten al contenido */
        th:nth-child(1), td:nth-child(1) { width: min-content; text-align: center; } /* Fecha - se adapta al contenido */
        th:nth-child(2), td:nth-child(2) { width: auto; } /* T√≠tulo del directo - se expande */
        th:nth-child(3), td:nth-child(3) { width: min-content; text-align: center; } /* Precio - se adapta al contenido */
        th:nth-child(4), td:nth-child(4) { width: min-content; } /* Procesador - se adapta al contenido */
        th:nth-child(5), td:nth-child(5) { width: min-content; } /* Tarjeta gr√°fica - se adapta al contenido */
        th:nth-child(6), td:nth-child(6) { width: min-content; } /* Torre - se adapta al contenido */

        th:last-child, td:last-child {
            border-right: none;
        }

        .data-table tbody tr:nth-child(even) {
            background: rgba(0,0,0,0.1) !important;
        }
        
        .data-table tbody tr:nth-child(odd) {
            background: rgba(255,255,255,0.9) !important;
        }
        
        .data-table tbody tr:nth-child(even):hover {
            background: rgba(0,0,0,0.15) !important;
        }
        
        .data-table tbody tr:nth-child(odd):hover {
            background: rgba(255,255,255,1) !important;
        }

        .refresh-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            margin: 20px auto;
            display: block;
            transition: background 0.3s ease;
        }

        .refresh-btn:hover {
            background: #5a6fd8;
        }

        /* Clases para elementos espec√≠ficos */
        .hidden {
            display: none;
        }

        .stats-button-container {
            margin-top: 20px;
            text-align: center;
        }

        .go-to-analysis-btn {
            background: #27ae60 !important;
            margin: 0 auto;
            display: block;
            padding: 6px 14px;
            font-size: 0.9rem;
        }

        .back-button-container {
            text-align: center;
            margin-bottom: 20px;
        }

        .back-to-data-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.9rem;
            margin: 15px auto;
            display: block;
            transition: background 0.3s ease;
        }

        .back-to-data-btn:hover {
            background: #218838;
        }

        .analysis-title {
            color: #667eea;
            text-align: center;
            margin-bottom: 20px;
        }

        .last-updated {
            text-align: center;
            color: white;
            margin-top: 20px;
            opacity: 0.8;
        }

        .stats-info {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            text-align: center;
        }

        .stats-info h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-card {
            background: #e9ecef;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }

        /* Fondo m√°s oscuro solo para "Total de Montajes" */
        .stat-card:first-child {
            background: #d1d3d4;
        }

        .stat-card .number {
            font-size: 1.8rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .stat-card .label {
            color: #666;
            font-size: 0.9rem;
            font-weight: bold;
        }

        /* Cada tabla individual del an√°lisis tiene su propio scroll */
        .analysis-section {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            position: relative;
        }

        .analysis-section .table-container {
            overflow-x: scroll !important;
            overflow-y: visible !important;
            width: 100% !important;
            -webkit-overflow-scrolling: touch !important;
            scrollbar-width: thin !important;
            scrollbar-color: #667eea #f0f0f0 !important;
        }

        .analysis-section table {
            width: 100%;
            min-width: 900px !important;
            border-collapse: collapse;
            color: white;
        }

        /* Scrollbar forzado */
        .analysis-section .table-container::-webkit-scrollbar {
            height: 15px !important;
            background: #f0f0f0 !important;
        }

        .analysis-section .table-container::-webkit-scrollbar-thumb {
            background: #ff0000 !important;
            border-radius: 2px !important;
        }

        .analysis-section .table-container::-webkit-scrollbar-track {
            background: #f0f0f0 !important;
            border-radius: 8px !important;
        }

        .analysis-section h2 {
            color: #667eea;
            text-align: center;
            margin-bottom: 20px;
        }

        .analysis-section h3 {
            color: white;
            text-align: center;
            margin-bottom: 15px;
        }

        .analysis-section th, .analysis-section td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid rgba(255,255,255,0.3);
            white-space: nowrap;
        }

        .analysis-section th {
            background-color: #667eea;
            color: white;
            font-weight: 600;
            text-align: center;
        }

        .analysis-section tr:last-child td {
            border-bottom: 1px solid black;
        }

        .analysis-section td:nth-child(2), .analysis-section td:nth-child(3) {
            text-align: center;
        }

        .analysis-section .number {
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
        }

        .analysis-section .label {
            color: #666;
            font-size: 0.9rem;
        }

        .data-table th {
            position: sticky;
            top: 0;
            z-index: 10;
            background-color: #667eea;
            color: white;
            font-weight: 600;
            text-align: center;
        }

        /* Contenedor espec√≠fico para scroll horizontal en an√°lisis */
        #analysis-container .analysis-content {
            overflow-x: auto;
            overflow-y: visible;
            width: 100%;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: thin;
            scrollbar-color: #667eea #f0f0f0;
        }

        /* Estilos para el scrollbar en webkit */
        #analysis-container .analysis-content::-webkit-scrollbar {
            height: 8px;
        }

        #analysis-container .analysis-content::-webkit-scrollbar-track {
            background: #f0f0f0;
            border-radius: 4px;
        }

        #analysis-container .analysis-content::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 4px;
        }

        /* Eliminar espacio en blanco en las tablas del an√°lisis */
        #analysis-container .table-container {
            height: auto !important;
            min-height: auto !important;
            max-height: none !important;
        }

        #analysis-container table {
            height: auto !important;
            min-height: auto !important;
        }

        #analysis-container tbody {
            height: auto !important;
        }

        /* Scrollbar siempre visible para las tablas del an√°lisis */
        .table-container::-webkit-scrollbar {
            height: 8px !important;
            background: #f0f0f0 !important;
        }

        .table-container::-webkit-scrollbar-thumb {
            background: #ff0000 !important;
            border-radius: 2px !important;
        }

        .table-container::-webkit-scrollbar-track {
            background: #f0f0f0 !important;
            border-radius: 2px !important;
        }

        /* Forzar el mismo color en todas las tablas del an√°lisis */
        #analysis-container .table-container::-webkit-scrollbar {
            height: 8px !important;
            background: #f0f0f0 !important;
        }

        #analysis-container .table-container::-webkit-scrollbar-thumb {
            background: #ff0000 !important;
            border-radius: 2px !important;
        }

        #analysis-container .table-container::-webkit-scrollbar-track {
            background: #f0f0f0 !important;
            border-radius: 2px !important;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }

            .data-table {
                overflow-x: scroll;
                -webkit-overflow-scrolling: touch;
            }

            table {
                min-width: 900px;
            }

            /* Mejorar scroll horizontal para las tablas del an√°lisis */
            #analysis-container .data-table {
                overflow-x: scroll;
                -webkit-overflow-scrolling: touch;
            }

            #analysis-container table {
                min-width: 700px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Montajes de GabyxHD en 2025</h1>
        </div>

        <div id="loading" class="loading">
            <span class="spinner">‚è≥</span> Conectando a Google Sheets...
        </div>

        <div id="error" class="error hidden"></div>

        <!-- Informaci√≥n de Estad√≠sticas -->
        <div id="stats-info" class="stats-info hidden">
            <h3>‚ÑπÔ∏è Informaci√≥n de los Montajes</h3>
            <div id="stats-grid" class="stats-grid"></div>
            <div class="stats-button-container">
                <button id="go-to-analysis-btn" class="refresh-btn go-to-analysis-btn">
                    üìä Ver An√°lisis Autom√°tico
                </button>
            </div>
        </div>

        <!-- Tabla de Datos -->
        <div id="data-container" class="hidden">
            <div class="data-table">
                <div id="table-container"></div>
            </div>
        </div>

        <!-- Secci√≥n de An√°lisis (oculta por defecto) -->
        <div id="analysis-container" class="hidden">
            <div class="back-button-container">
                <button id="back-to-data-btn" class="refresh-btn back-to-data-btn">
                    ‚¨ÖÔ∏è Volver a los Datos
                </button>
            </div>
            <div class="data-table">
                <h2 class="analysis-title">
                    üìä An√°lisis de Componentes Montados
                </h2>
                <div id="analysis-content"></div>
            </div>
            
            <!-- Bot√≥n adicional debajo del an√°lisis -->
            <div style="margin-top: 25px; text-align: center;">
                <button id="back-to-data-btn-bottom" class="refresh-btn back-to-data-btn">
                    ‚¨ÖÔ∏è Volver a los Datos
                </button>
            </div>
        </div>

        <button id="refresh-btn" class="refresh-btn hidden">
            üîÑ Actualizar Datos
        </button>

        <div id="last-updated" class="last-updated hidden"></div>
    </div>

    <script>
        class PCBuildsViewer {
            constructor() {
                this.sheetsData = {};
                this.apiUrl = 'https://gabyxhd-production.up.railway.app/api/sheets-data'; // Backend en Railway
                this.spreadsheetId = '1OCMcUJ0VerXZLEgyjapb_lNvRZQL05lIcGf882AaTfU';
                this.init();
            }

            async init() {
                try {
                    await this.loadSheetData('Datos');
                    this.setupEventListeners();
                    this.showRefreshButton();
                    this.hideLoading();
                } catch (error) {
                    this.showError('Error al inicializar: ' + error.message);
                    this.hideLoading();
                }
            }

            async loadSheetData(sheetName) {
                try {
                    const response = await fetch(this.apiUrl);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const result = await response.json();
                    
                    if (!result.success) {
                        throw new Error(result.error || 'Error al obtener datos');
                    }
                    
                    // Procesar los datos del backend
                    const rows = result.data;
                    const headers = result.headers;
                    
                    if (!rows || rows.length === 0) {
                        throw new Error('No se encontraron datos en la hoja');
                    }
                    
                    // Convertir los datos al formato esperado por el frontend
                    const processedRows = rows.map(row => [
                        row['Fecha'] || '',
                        row['T√≠tulo del directo de Twitch'] || '',
                        row['Precio en ‚Ç¨'] || '',
                        row['Procesador'] || '',
                        row['Tarjeta gr√°fica'] || '',
                        row['Torre'] || ''
                    ]);
                    
                    // Agregar los headers al inicio
                    processedRows.unshift(headers);
                    
                    this.sheetsData[sheetName] = processedRows;
                    this.displaySheetData(sheetName);
                    this.displayStats();
                    this.generateAnalysis(processedRows);
                    
                } catch (error) {
                    console.error('Error al cargar datos:', error);
                    throw new Error('Error al cargar datos de la hoja: ' + error.message);
                }
            }

            generateAnalysis(data) {
                if (!data || data.length < 2) return;
                
                const rows = data.slice(1); // Excluir la fila de headers
                const processors = {};
                const graphics = {};
                const cases = {};

                // √çndices de las columnas
                const priceIndex = 2; // Precio en ‚Ç¨
                const processorIndex = 3; // Procesador
                const graphicsIndex = 4; // Tarjeta gr√°fica
                const caseIndex = 5; // Torre

                rows.forEach(row => {
                    // An√°lisis de procesadores
                    const processorItem = row[processorIndex];
                    if (processorItem && processorItem.trim() !== '') {
                        const cleanProcessor = processorItem.trim();
                        processors[cleanProcessor] = (processors[cleanProcessor] || 0) + 1;
                    }

                    // An√°lisis de tarjetas gr√°ficas
                    const graphicsItem = row[graphicsIndex];
                    if (graphicsItem && graphicsItem.trim() !== '') {
                        const cleanGraphics = graphicsItem.trim();
                        graphics[cleanGraphics] = (graphics[cleanGraphics] || 0) + 1;
                    }

                    // An√°lisis de torres
                    const caseItem = row[caseIndex];
                    if (caseItem && caseItem.trim() !== '') {
                        const cleanCase = caseItem.trim();
                        cases[cleanCase] = (cases[cleanCase] || 0) + 1;
                    }
                });

                // An√°lisis de precios
                const prices = rows.map(row => parseFloat(row[priceIndex])).filter(p => !isNaN(p));
                const avgPrice = prices.length > 0 ? prices.reduce((a, b) => a + b, 0) / prices.length : 0;
                const minPrice = Math.min(...prices);
                const maxPrice = Math.max(...prices);

                this.displayAnalysis(processors, graphics, cases, { avg: avgPrice, min: minPrice, max: maxPrice, total: rows.length });
            }

            displayAnalysis(processors, graphics, cases, prices) {
                // Crear contenido del an√°lisis
                const analysisContent = document.getElementById('analysis-content');
                
                analysisContent.innerHTML = `
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                        <div style="background: #00CED1; border-radius: 15px; padding: 20px; box-shadow: 0 5px 15px rgba(0, 206, 209, 0.3);">
                            <h3 style="color: black; text-align: center; margin-bottom: 20px; font-size: 1.3rem; text-shadow: 0 2px 4px rgba(255,255,255,0.3);">
                                Procesadores
                            </h3>
                            ${this.generateAnalysisTable(processors, 'Procesador', 'processor')}
                        </div>
                        
                        <div style="background: #FFD700; border-radius: 15px; padding: 20px; box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);">
                            <h3 style="color: black; text-align: center; margin-bottom: 20px; font-size: 1.3rem; text-shadow: 0 2px 4px rgba(255,255,255,0.3);">
                                Tarjetas Gr√°ficas
                            </h3>
                            ${this.generateAnalysisTable(graphics, 'Tarjeta Gr√°fica', 'graphics')}
                        </div>
                        
                        <div style="background: #FF8C00; border-radius: 15px; padding: 20px; box-shadow: 0 5px 15px rgba(255, 140, 0, 0.3);">
                            <h3 style="color: black; text-align: center; margin-bottom: 20px; font-size: 1.3rem; text-shadow: 0 2px 4px rgba(255,255,255,0.3);">
                                Torres
                            </h3>
                            ${this.generateAnalysisTable(cases, 'Torre', 'case')}
                        </div>
                    </div>
                    
                    <div style="margin-top: 25px; text-align: center; padding: 25px; background: linear-gradient(135deg, #f8f9fa, #e9ecef); border-radius: 15px; border: 2px solid #667eea;">
                        <h3 style="color: #667eea; margin-bottom: 20px; font-size: 1.4rem;">
                            Resumen de Precios
                        </h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 20px;">
                            <div style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 3px 10px rgba(0,0,0,0.1);">
                                <div style="font-size: 2rem; font-weight: bold; color: #667eea; margin-bottom: 8px;">${Math.round(prices.avg)}‚Ç¨</div>
                                <div style="color: #666; font-size: 1rem; font-weight: 500;">Precio Promedio</div>
                            </div>
                            <div style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 3px 10px rgba(0,0,0,0.1);">
                                <div style="font-size: 2rem; font-weight: bold; color: #27ae60; margin-bottom: 8px;">${prices.min}‚Ç¨</div>
                                <div style="color: #666; font-size: 1rem; font-weight: 500;">Precio M√≠nimo</div>
                            </div>
                            <div style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 3px 10px rgba(0,0,0,0.1);">
                                <div style="font-size: 2rem; font-weight: bold; color: #e74c3c; margin-bottom: 8px;">${prices.max}‚Ç¨</div>
                                <div style="color: #666; font-size: 1rem; font-weight: 500;">Precio M√°ximo</div>
                            </div>
                        </div>
                    </div>
                `;
            }

            generateAnalysisTable(data, title, type) {
                const sortedData = Object.entries(data)
                    .sort(([,a], [,b]) => b - a);

                let tableHTML = `
                    <div class="table-container" style="overflow-x: scroll; overflow-y: visible; width: 100%; -webkit-overflow-scrolling: touch;">
                        <table style="width: 100%; min-width: 400px; border-collapse: collapse; color: black; font-size: 0.9rem;">
                            <thead>
                                <tr style="background: rgba(255,255,255,0.15);">
                                    <th style="padding: 8px 8px; text-align: center; border-bottom: 2px solid black; border-right: 1px solid black; font-weight: 600; font-size: 0.9rem; color: black; width: 250px;">${title}</th>
                                    <th style="padding: 8px 8px; text-align: center; border-bottom: 2px solid black; border-right: 1px solid black; font-weight: 600; font-size: 0.9rem; color: black; width: 80px;">N¬∞ veces</th>
                                    <th style="padding: 8px 8px; text-align: center; border-bottom: 2px solid black; font-weight: 600; font-size: 0.9rem; color: black; width: 60px;">%</th>
                                </tr>
                            </thead>
                            <tbody>
                `;

                const total = Object.values(data).reduce((sum, count) => sum + count, 0);

                sortedData.forEach(([name, count], index) => {
                    const percentage = ((count / total) * 100).toFixed(1);
                    const isEven = index % 2 === 0;
                    const rowStyle = isEven ? 'background: rgba(255,255,255,0.3);' : 'background: rgba(255,255,255,0.1);';
                    
                    tableHTML += `
                        <tr style="${rowStyle}">
                            <td style="padding: 6px 8px; border-bottom: 1px solid black; border-right: 1px solid black; font-weight: bold; font-size: 0.9rem; color: black; text-align: left; width: 250px;">${name}</td>
                            <td style="padding: 6px 8px; text-align: center; border-bottom: 1px solid black; border-right: 1px solid black; font-weight: bold; font-size: 0.9rem; color: black; width: 80px;">${count}</td>
                            <td style="padding: 6px 8px; text-align: center; border-bottom: 1px solid black; font-weight: bold; font-size: 0.9rem; color: black; width: 60px;">${percentage}%</td>
                        </tr>
                    `;
                });

                tableHTML += '</tbody></table></div>';
                
                // Agregar resumen del total de componentes √∫nicos
                const uniqueComponents = Object.keys(data).length;
                const totalUsage = total;
                
                tableHTML += `
                    <div style="margin-top: 15px; padding: 10px; background: rgba(255,255,255,0.1); border: 2px solid black; border-radius: 8px; text-align: center;">
                        <span style="font-weight: 600; font-size: 0.9rem; color: black;">Total: ${uniqueComponents} componentes √∫nicos</span> | 
                        <span style="font-weight: 600; font-size: 0.9rem; color: black;">Uso total: ${totalUsage} veces</span>
                    </div>
                `;
                
                return tableHTML;
            }

            async refreshData() {
                try {
                    this.showLoading('Actualizando datos...');
                    await this.loadSheetData('Datos');
                    this.updateLastUpdated();
                    this.hideLoading();
                } catch (error) {
                    this.showError('Error al actualizar: ' + error.message);
                    this.hideLoading();
                }
            }

            updateLastUpdated() {
                const now = new Date();
                const timeString = now.toLocaleString('es-ES');
                document.getElementById('last-updated').innerHTML = 
                    `‚è∞ √öltima actualizaci√≥n: ${timeString}`;
                document.getElementById('last-updated').style.display = 'block';
            }

            setupEventListeners() {
                document.getElementById('refresh-btn').onclick = () => this.refreshData();
                document.getElementById('go-to-analysis-btn').onclick = () => this.showAnalysis();
                document.getElementById('back-to-data-btn').onclick = () => this.showData();
                document.getElementById('back-to-data-btn-bottom').onclick = () => this.showData(); // Add listener for the new button
            }

            showAnalysis() {
                // Asegurar que el an√°lisis est√© generado
                if (this.sheetsData['Datos'] && this.sheetsData['Datos'].length > 1) {
                    this.generateAnalysis(this.sheetsData['Datos']);
                }
                
                // OCULTAR COMPLETAMENTE la secci√≥n de datos y estad√≠sticas
                document.getElementById('data-container').style.display = 'none';
                document.getElementById('stats-info').style.display = 'none';
                
                // MOSTRAR SOLO la secci√≥n de an√°lisis
                document.getElementById('analysis-container').style.display = 'block';
                document.getElementById('analysis-container').classList.remove('hidden');
                
                // Desplazarse al inicio de la p√°gina
                setTimeout(() => {
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }, 100);
                
                // Alternativa si el scroll suave no funciona
                setTimeout(() => {
                    if (window.pageYOffset > 0) {
                        window.scrollTo(0, 0);
                    }
                }, 500);
            }

            showData() {
                // OCULTAR la secci√≥n de an√°lisis
                document.getElementById('analysis-container').style.display = 'none';
                document.getElementById('analysis-container').classList.add('hidden');
                
                // MOSTRAR la secci√≥n de datos y estad√≠sticas
                document.getElementById('data-container').style.display = 'block';
                document.getElementById('stats-info').style.display = 'block';
                
                // Desplazarse arriba del todo - FORZAR el scroll
                setTimeout(() => {
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }, 100);
                
                // Alternativa si el scroll suave no funciona
                setTimeout(() => {
                    if (window.pageYOffset > 0) {
                        window.scrollTo(0, 0);
                    }
                }, 500);
            }

            showRefreshButton() {
                document.getElementById('refresh-btn').classList.remove('hidden');
            }

            showLoading(message) {
                document.getElementById('loading').innerHTML = `‚è≥ ${message}`;
                document.getElementById('loading').style.display = 'block';
            }

            hideLoading() {
                document.getElementById('loading').style.display = 'none';
            }

            showError(message) {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').textContent = message;
                document.getElementById('error').classList.remove('hidden');
            }

            displayStats() {
                const data = this.sheetsData['Datos'];
                if (!data || data.length < 2) return;

                const totalRows = data.length - 1; // Excluir headers
                const uniqueProcessors = new Set();
                const uniqueGraphics = new Set();
                const uniqueCases = new Set();

                // Contar componentes √∫nicos
                data.slice(1).forEach(row => {
                    if (row[3] && row[3].trim()) uniqueProcessors.add(row[3].trim());
                    if (row[4] && row[4].trim()) uniqueGraphics.add(row[4].trim());
                    if (row[5] && row[5].trim()) uniqueCases.add(row[5].trim());
                });

                const statsGrid = document.getElementById('stats-grid');
                statsGrid.innerHTML = `
                    <div class="stat-card">
                        <div class="number">${totalRows}</div>
                        <div class="label">Total de Montajes</div>
                    </div>
                    <div class="stat-card">
                        <div class="number">${uniqueCases.size}</div>
                        <div class="label">Torres √önicas</div>
                    </div>
                    <div class="stat-card">
                        <div class="number">${uniqueProcessors.size}</div>
                        <div class="label">Procesadores √önicos</div>
                    </div>
                    <div class="stat-card">
                        <div class="number">${uniqueGraphics.size}</div>
                        <div class="label">Tarjetas Gr√°ficas √önicas</div>
                    </div>
                `;

                document.getElementById('stats-info').classList.remove('hidden');
                document.getElementById('data-container').style.display = 'block';
            }

            displaySheetData(sheetName) {
                const data = this.sheetsData[sheetName];
                if (!data || data.length === 0) {
                    document.getElementById('table-container').innerHTML = '<p>No hay datos en esta hoja.</p>';
                    return;
                }

                const headers = data[0];
                const rows = data.slice(1);

                let tableHTML = '<table><thead><tr>';
                headers.forEach(header => {
                    tableHTML += `<th>${header}</th>`;
                });
                tableHTML += '</tr></thead><tbody>';

                rows.forEach((row, index) => {
                    if (index === 0) return; // Skip header row
                    
                    tableHTML += '<tr>';
                    headers.forEach((header, cellIndex) => {
                        const cellValue = row[cellIndex] || '';
                        const cellStyle = 'padding: 8px 8px; border-bottom: 1px solid black; border-right: 1px solid black; white-space: nowrap;';
                        
                        // Center align specific columns
                        if (cellIndex === 0 || cellIndex === 2) { // Date and Price columns
                            tableHTML += `<td style="${cellStyle} text-align: center;">${cellValue}</td>`;
                        } else {
                            tableHTML += `<td style="${cellStyle}">${cellValue}</td>`;
                        }
                    });
                    tableHTML += '</tr>';
                });

                tableHTML += '</tbody></table>';
                document.getElementById('table-container').innerHTML = tableHTML;
            }
        }

        // Inicializar la aplicaci√≥n cuando se carga la p√°gina
        document.addEventListener('DOMContentLoaded', () => {
            new PCBuildsViewer();
        });
    </script>
</body>
</html>

